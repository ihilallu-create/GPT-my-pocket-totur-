name: Auto Sync from emergent-github-gpt

on:
  # يشتغل تلقائياً عند أي تعديل على الفرع الرئيسي
  push:
    branches:
      - main
  # يشتغل كل 6 ساعات بشكل دوري
  schedule:
    - cron: "0 */6 * * *"
  # يسمح لك تشغلو يدوي من Actions
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      # نسخ المستودع الأول (الخاص للقراءة فقط)
      - name: Checkout emergent-github-gpt
        uses: actions/checkout@v3
        with:
          repository: ihilallu-create/emergent-github-gpt
          token: ${{ secrets.GPT_GITHUB_POCKET_TOTUR_KEY }}
          path: emergent

      # نسخ المستودع الثاني (التدريب والتطوير)
      - name: Checkout gpt-pocket-totur-learn
        uses: actions/checkout@v3
        with:
          repository: ihilallu-create/gpt-pocket-totur-learn
          token: ${{ secrets.GPT_GITHUB_POCKET_TOTUR_KEY }}
          path: pocket

      # نسخ الملفات من الأول للثاني
      - name: Sync files
        run: |
          cp -r emergent/* pocket/

      # رفع التغييرات لمستودع 2
      - name: Commit and Push changes
        run: |
          cd pocket
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add .
          git commit -m "Auto-sync from emergent-github-gpt" || echo "No changes to commit"
          git push https://x-access-token:${{ secrets.GPT_GITHUB_POCKET_TOTUR_KEY }}@github.com/ihilallu-create/gpt-pocket-totur-learn.git main
